---
import Layout from "../layouts/Layout.astro";
import OffreCard from "../components/OffreCard.astro";
import { getOffres } from "../backend.mjs";

const offres = await getOffres();
---

<Layout titre="Offres">
	<h1 class="text-3xl font-bold mb-6">Offres</h1>

	<div class="container mx-auto px-4">
		<button
			id="favori-button"
			class="bg-slate-600 rounded-lg text-white p-2 mb-4 hover:bg-slate-700 transition-colors"
		>
			Afficher les favoris
		</button>
		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
			{offres.map((offre) => <OffreCard offre={offre} />)}
		</div>
	</div>
</Layout>

<script>
	const button = document.getElementById("favori-button");
	let showOnlyFavorites = false;

	button?.addEventListener("click", () => {
		showOnlyFavorites = !showOnlyFavorites;
		const offres = document.querySelectorAll<HTMLElement>(".offre");

		offres.forEach((offre) => {
			const isFavori = offre.dataset.favori === "true";

			if (showOnlyFavorites) {
				offre.style.display = isFavori ? "block" : "none";
				button.textContent = "Afficher tout";
			} else {
				offre.style.display = "block";
				button.textContent = "Afficher les favoris";
			}
		});
	});
</script>
